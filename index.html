<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"> 
	<link href="lib/materialize/materialize.min.css" type="text/css" rel="stylesheet" />
	<link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="css/style_propio.css" type="text/css" rel="stylesheet" />
	<title>Compras y Ventas</title>


	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
	<script>
// Initialize Firebase
var config = {
	apiKey: "AIzaSyAeY5ekmTdQKT5nQj_BFdO_t4l9g1gw1CQ",
	authDomain: "just-for-now-shop.firebaseapp.com",
	databaseURL: "https://just-for-now-shop.firebaseio.com",
	storageBucket: "just-for-now-shop.appspot.com",
	messagingSenderId: "309599821973",
	GoogleAuthProvider: "Du1pewHMg125Pl2kN1_r8mu4"
};
firebase.initializeApp(config);
var database=firebase.database();
</script>
</head>
<body background="img/fondo.jpg">
	<nav>
		<ul id='dropdown1' class='dropdown-content'>
			<li><a href="camaras.html">Camaras y Accesorios</a></li>
			<li class="divider"></li>
			<li><a href="celulares.html">Celulares y Teléfonos</a></li>
			<li class="divider"></li>
			<li><a href="computacion.html">Computación</a></li>
			<li class="divider"></li>
			<li><a href="consolas.html">Consolas y Videojuegos</a></li>
			<li class="divider"></li>
			<li><a href="electrodomesticos.html">Electrodomesticos</a></li>
			<li class="divider"></li>
			<li><a href="audio-video.html">Electrónica Audio y Video</a></li>
		</ul>
		<div class="nav-wrapper light-green">
			<a href="index.html" id="logo" class="brand-logo right"><img src="img/logo.png" style="width:70px;height:70px;"></img></a>
			<a href="index.html" id="titulo" class="brand-logo right">JFN SHOP</a>
			<ul class="leftS hide-on-med-and-down">
				<li><a class="dropdown-button" href="#!" data-activates="dropdown1">Categorias<i class="material-icons right">arrow_drop_down</i></a></li>

			</ul>
			<div class="input-field" id= "buscar">
				<input id="search" type="search" required>
				<label for="search"><i class="material-icons">search</i></label>
				<i class="material-icons">close</i>
			</div>
		</div>

	</nav>

	<div class="login"> 
		<div class="z-depth-5">
			<p class="center">Debes ingresar para poder comprar</p>
			<div class="row">
				<div class="col s12" id="login">
					<div class="row">       
						<div class="input-field col s6">
							&nbsp;&nbsp;&nbsp;
							<input class="mdl-textfield__input" style="display:inline;width:auto;" type="text" id="user" name="user" placeholder="User">
							<label for="email">Usuario</label>
						</div>
					</div>
					<div class="row">       
						<div class="input-field col s6">
							&nbsp;&nbsp;&nbsp;
							<input class="mdl-textfield__input" style="display:inline;width:auto;" type="text" id="email" name="email" placeholder="Email">
							<label for="email">Email</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							&nbsp;&nbsp;&nbsp;
							<input class="mdl-textfield__input" style="display:inline;width:auto;" type="password" id="password" name="password" placeholder="Password">
							<label for="password">Contraseña</label>
						</div>
					</div>
					&nbsp;&nbsp;&nbsp;
					<center><button class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-in" name="signin">Sign In</button></center>
					&nbsp;&nbsp;&nbsp;
					<center><button onclick="handleSignUp(), save()" class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-up" name="signup" >Sign Up</button></center><br>
					
					<br>
				</div>
				<div id="logout">
					<center><button class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-out" name="signup" >Sign out</button></center><br>
				</div>
			</div>
		</div>
	</div>

</body>
<script src="lib/jquery-2.2.4.min.js"></script>
<script src="lib/materialize/materialize.min.js"></script>
<script type="text/javascript" src="js/scripts.js"></script>s
<script>
	
	function toggleSignIn() {
		if (firebase.auth().currentUser) {
        // [START signout]
        firebase.auth().signOut();
        // [END signout]
    } else {
    	var email = document.getElementById('email').value;
    	var password = document.getElementById('password').value;
    	console.log(email);
    	if (email.length < 4) {
    		alert('Please enter an email address.');
    		return;
    	}
    	if (password.length < 4) {
    		alert('Please enter a password.');
    		return;
    	}
        // Sign in with email and pass.
        // [START authwithemail]
        console.log("entro");
        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode == 'auth/wrong-password') {
          	alert('Wrong password.');
          } else {
          	alert(errorMessage);
          }
          console.log(error);
          
          // [END_EXCLUDE]
      });
        // [END authwithemail]
    }
}

    /**
     * Handles the sign up button press.
     */
     function handleSignUp() {
     	var email = document.getElementById('email').value;
     	var password = document.getElementById('password').value;
     	if (email.length < 4) {
     		alert('Please enter an email address.');
     		return;
     	}
     	if (password.length < 4) {
     		alert('Please enter a password.');
     		return;
     	}
      // Sign in with email and pass.
      // [START createwithemail]
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/weak-password') {
        	alert('The password is too weak.');
        } else {
        	alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
    });
      // [END createwithemail]
  }

      // Listening for auth state changes.
      // [START authstatelistener]
      console.log("entro al initApp");
      firebase.auth().onAuthStateChanged(function(user) {

      	console.log("Cambio usuario"+ user);
      	if (user) {
      		$("#logout").slideDown();
      		$("#login").slideUp();
      		//alert("Estas logueado");
      		salario();


          // [END_EXCLUDE]
      } else {
      	$("#logout").slideUp();
      	$("#login").slideDown();


          // [END_EXCLUDE]
      }
        // [START_EXCLUDE silent]
        //document.getElementById('quickstart-sign-in').disabled = false;
        // [END_EXCLUDE]
    });

      

      $("#quickstart-sign-in").on("click",function(){
      	console.log("Saliendo");
      	toggleSignIn();

      	console.log("Salio?");
      });

      $("#quickstart-sign-out").on("click",function(){
      	console.log("Saliendo");
      	firebase.auth().signOut();
      });

      function save(){
      	console.log("Guardando");
      	var userData = {
      		usuario: $("#user").val(),
      		email: $("#email").val(),
      		salario: 100,
      	};

		// Get a key for a new Post.
		var userKey = firebase.database().ref().child('usuarios').push().key;

		// Write the new post's data simultaneously in the posts list and the user's post list.
		var updates = {};
		updates['/usuarios/' + userKey] = userData;  

		firebase.database().ref().update(updates);
	} 
	 


	function salario(){
		console.log("buscando salario");
		//URl de las notas
		var qn = firebase.database().ref('usuarios/');
		//buscamos notas
		qn.once('value', 
			function(usuarios){  // Si esta todo bien
				console.log(usuarios);
				var user = firebase.auth().currentUser;
				
				usuarios.forEach(function(usuario){	
					console.log(usuario.key);
												
					if (user.email == usuario.val().email){
						alert("su salario es: " + usuario.val().salario);
					}


				});
			},
			function(error){ //si hay un error
				console.log(error);

			});
	}

</script>
</html>